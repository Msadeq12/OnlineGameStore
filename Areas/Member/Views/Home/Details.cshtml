@model PROG3050_HMJJ.Areas.Admin.Models.GamesViewModel
@using Microsoft.AspNetCore.Identity
@using PROG3050_HMJJ.Models.Account;
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@{
    ViewData["Title"] = "Game Details";
}

<h1>@ViewData["Title"]</h1>

<div>
    <hr />
    <dl class="row">
 @*        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.ID)
        </dt> *@
        @* <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ID)
        </dd> *@
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Title)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Title)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Description)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Price)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Price)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Publisher)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Publisher)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.ReleaseYear)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ReleaseYear)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.GameGenre)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.GameGenre)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.GamePlatform)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.GamePlatform)
        </dd>
    </dl>
</div>
<div class="card card-outline-secondary my-4">
    <div class="card-header">
        Game Reviews
    </div>
    <div class="card-body">
        @if (Model.ApprovedReviews.Any())
        {
            foreach (var review in Model.ApprovedReviews)
            {
                <p>@review.CommentText</p>
                <small class="text-muted">Posted by @review.UserId on @review.Timestamp.ToShortDateString()</small>
                <hr>
                <!-- Optionally display more information about the review -->
            }
        }
        else
        {
            <p>There are no reviews yet. Be the first one to review!</p>
        }

        <!--Add the approved reviews here-->
        @{
            // Generate a new GUID and convert it to a string
            string newCommentId = Guid.NewGuid().ToString();
            string newRatingID = Guid.NewGuid().ToString();
            string gametitle = Model.Title;
        }

        <form asp-action="SubmitReview" asp-area="Member" asp-controller="Home" method="post">
            <input type="hidden" asp-for="NewReview.GameId" />
            <input type="hidden" asp-for="NewReview.CommentId" value="@newCommentId" />
            <input type="hidden" asp-for="NewReview.GameName" value="@gametitle" />
            <input type="hidden" asp-for="NewReview.UserId" value="@ViewBag.CurrentUsername" />@* @UserManager.GetUserName(User) *@
            <div class="form-group">
                <label asp-for="NewReview.CommentText">Leave a Comment</label>
                <textarea asp-for="NewReview.CommentText" class="form-control" rows="3" placeholder="Leave your comment here"></textarea>
                <span asp-validation-for="NewReview.CommentText"></span>
            </div>

            <button class="btn btn-success" type="submit">Submit your Comment</button>
        </form>
    </div>
</div>
<div class="card card-outline-secondary my-4">
    <div class="card-header">
        Game Ratings
    </div>
    <div class="card-body">
        @if (Model.Ratings.Any())
        {
            foreach (var rating in Model.Ratings)
            {
                <p>@rating.Value.ToString()</p>
                <small class="text-muted">Posted by @rating.UserName</small>
                <hr>
                <!-- Optionally display more information about the rating -->
            }
        }
        else
        {
            <p>There are no ratings yet. Be the first one to rate!</p>
        }

        <!--Add the approved ratings here-->

        <form asp-action="SubmitRating" asp-area="Member" asp-controller="Home" method="post">
            <input type="hidden" asp-for="NewRating.GameID" />
            <input type="hidden" asp-for="NewRating.UserName" value="@ViewBag.CurrentUsername" />@* @UserManager.GetUserName(User) *@
            <div class="form-group">
                <label asp-for="NewRating.Value">Leave a Comment</label>
                <select asp-for="NewRating.Value" class="form-control" rows="3" placeholder="Leave your comment here">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <span asp-validation-for="NewRating.Value"></span>
            </div>

            <button class="btn btn-success" type="submit">Submit your Rating</button>
        </form>
    </div>
</div>

<div>
    @*@Html.ActionLink("Edit", "Edit", new { /* id = Model.PrimaryKey */ }) |*@
    <a asp-action="Index">Back to List</a>
</div>
@if (TempData["ReviewMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["ReviewMessage"]
    </div>
}
